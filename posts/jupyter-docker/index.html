<!doctype html><html lang=en><head><title>Mastering Dockerized Jupyter: A Secure, Reproducible, and Efficient Data Science Workflow :: Oli Wilkins</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
In the world of data science, where the intersection of sensitive information and the need for smooth collaboration is crucial, Dockerized Jupyter emerges as a valuable solution. Imagine this scenario: you&rsquo;re entrusted with confidential data and are required to work within a secure virtual environment. Time is of the essence, and ensuring the reproducibility of your results is vital. But how can you navigate this complex terrain?
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://www.okwilkins.dev/posts/jupyter-docker/><script async src="https://www.googletagmanager.com/gtag/js?id=G-QFBNT4WHSV"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QFBNT4WHSV")}</script><link rel=stylesheet href=/search.css><link rel=stylesheet href=https://www.okwilkins.dev/assets/style.css><link rel=stylesheet href=https://www.okwilkins.dev/assets/blue.css><link rel=apple-touch-icon href=https://www.okwilkins.dev/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://www.okwilkins.dev/img/favicon/blue.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Mastering Dockerized Jupyter: A Secure, Reproducible, and Efficient Data Science Workflow"><meta property="og:description" content="
In the world of data science, where the intersection of sensitive information and the need for smooth collaboration is crucial, Dockerized Jupyter emerges as a valuable solution. Imagine this scenario: you&rsquo;re entrusted with confidential data and are required to work within a secure virtual environment. Time is of the essence, and ensuring the reproducibility of your results is vital. But how can you navigate this complex terrain?
"><meta property="og:url" content="https://www.okwilkins.dev/posts/jupyter-docker/"><meta property="og:site_name" content="Oli Wilkins"><meta property="og:image" content="https://www.okwilkins.dev/img/favicon/blue.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2024-03-19 00:00:00 +0000 UTC"><script type=module src=/js/search.js></script></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Oli Wilkins</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/knowledge-system>Knowledge System</a></li><li><a href=/my-work>My Work</a></li><li><a href=/posts>Posts</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/knowledge-system>Knowledge System</a></li><li><a href=/my-work>My Work</a></li><li><a href=/posts>Posts</a></li></ul></nav></header><div id=search><div><input id=searchInput placeholder=Search...></div><div id=searchResults></div></div><div class=content><div class=post><h1 class=post-title><a href=https://www.okwilkins.dev/posts/jupyter-docker/>Mastering Dockerized Jupyter: A Secure, Reproducible, and Efficient Data Science Workflow</a></h1><div class=post-meta><span class=post-date>2024-03-19
[Updated: 2024-03-19]</span></div><span class=post-tags>#<a href=https://www.okwilkins.dev/tags/docker/>Docker</a>&nbsp;
#<a href=https://www.okwilkins.dev/tags/jupyter/>Jupyter</a>&nbsp;
#<a href=https://www.okwilkins.dev/tags/data-science/>Data Science</a>&nbsp;
#<a href=https://www.okwilkins.dev/tags/devops/>DevOps</a>&nbsp;
#<a href=https://www.okwilkins.dev/tags/python/>Python</a>&nbsp;</span><div class=post-content><div><p><img src=/posts/jupyter-docker/./img/jupyter-shipping-container.png alt="Stable Diffusion XL&rsquo;s attempt to containerise Jupiter"></p><p>In the world of data science, where the intersection of sensitive information and the need for smooth collaboration is crucial, Dockerized Jupyter emerges as a valuable solution. Imagine this scenario: you&rsquo;re entrusted with confidential data and are required to work within a secure virtual environment. Time is of the essence, and ensuring the reproducibility of your results is vital. But how can you navigate this complex terrain?</p><p>Say goodbye to the challenges of version conflicts and the time-consuming setup procedures. Instead, adopt a streamlined approach to your workflow, enabling you to focus your efforts on gaining profound insights from your data.</p><p>In the following discussion, we will explore the common pitfalls often found in many Jupyter Dockerization guides. We will also delve into the finer details of securing and optimizing your Jupyter environment, ensuring that every data scientist can harness the benefits of Docker while maintaining data integrity and security.</p><p>The accompanying Github repo for this article can be found <a href=https://github.com/okwilkins/jupyter-docker-example>here</a>. You can take this away and use it how you like!</p><h2 id=another-article-dockerizing-jupyter>Another Article Dockerizing Jupyter?<a href=#another-article-dockerizing-jupyter class=hanchor arialabel=Anchor>&#8983;</a></h2><p>I recently undertook the task of Dockerizing Jupyter, applying it within my secure workflow. I thought that this would be a trivial task. <em><strong>Oh how I was wrong!</strong></em> Upon applying the contents of many different articles, I hit a few common problems. These problems rendered the articles unsuitable for my workflow.</p><p>I needed Jupyter to run securely, run on a virtual machine and to run alongside other Docker services.</p><h2 id=running-jupytersecurely>Running Jupyter Securely<a href=#running-jupytersecurely class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>jupyter/tensorflow-notebook</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span> <span style=color:#e6db74>/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span> <span style=color:#e6db74>root</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chmod -R <span style=color:#ae81ff>777</span> /app<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>python</span>: &lt;version&gt;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span> <span style=color:#e6db74>/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . /app<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip --no-cache-dir install numpy pandas seaborn sklearn jupyter<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span> <span style=color:#e6db74>8888</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;jupyter&#34;</span>, <span style=color:#e6db74>&#34;notebook&#34;</span>, <span style=color:#e6db74>&#34;--ip=&#39;*&#39;&#34;</span>, <span style=color:#e6db74>&#34;--port=8888&#34;</span>, <span style=color:#e6db74>&#34;--no-browser&#34;</span>, <span style=color:#e6db74>&#34;--allow-root&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Spot the mistakes made in both Docker files. The eagle-eyed among you may have noticed that both Dockerfiles run the container as root.</p><p>Running a Docker container as the root user, especially when using volumes, poses a significant security risk because it allows the container to potentially manipulate or access sensitive host system files and directories, leading to data leakage, unauthorized modifications, and overall system vulnerabilities. <strong>This will be of particular concern when working with sensitive data!</strong></p><p>Cast your eye to the bottom of this <a href=https://github.com/okwilkins/jupyter-docker-example/blob/main/Dockerfile>Dockerfile that I prepared</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span>...<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chown -R <span style=color:#e6db74>${</span>JUPYTER_USERNAME<span style=color:#e6db74>}</span> /home/<span style=color:#e6db74>${</span>JUPYTER_USERNAME<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span> <span style=color:#e6db74>${JUPYTER_USERNAME</span><span style=color:#f92672>}</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span> <span style=color:#e6db74>8888</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Note that the user is switched out from being root. Furthermore, the <a href=https://github.com/okwilkins/jupyter-docker-example/blob/main/docker-compose.yml>docker-compose.yml file</a> doesn&rsquo;t use the <code>--allow-root</code> flag when running the Jupyter command.</p><h2 id=using-volumes-with-jupyter-on-a-virtualmachine>Using Volumes With Jupyter On A Virtual Machine<a href=#using-volumes-with-jupyter-on-a-virtualmachine class=hanchor arialabel=Anchor>&#8983;</a></h2><p><img src=/posts/jupyter-docker/./img/iris-example.jpg alt="Jupyter running in VS Code"></p><p>There is a very high likelyhood that many of you run VS Code as your editor of choice when working with Jupyter notebooks. If you haven&rsquo;t tried it already, give it a whirl!</p><p>I wanted the Jupyter server to directly plug into my file system, as you see it on the left in the picture above. This is where volumes can be leveraged.</p><p>Taking a look at the <a href=https://github.com/okwilkins/jupyter-docker-example/blob/main/docker-compose.yml>supplied docker-compose.yml file</a> again, you can see that the data and notebook folders are being mirrored in the Docker container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>./data:/home/${JUPYTER_USERNAME}/data:rw</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>./notebooks:/home/${JUPYTER_USERNAME}/notebooks:rw</span>
</span></span></code></pre></div><p>There is a potential issue that stops these volumes being written to however! Take the following example:
On the virtual machine, here is a print out of the owner of each file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>oli@ssh-machine:~/jupyter-docker-example/notebooks$ ls -al
</span></span><span style=display:flex><span>total 396
</span></span><span style=display:flex><span>drwxr-xr-x 2 oli oli   4096 Sep  5 15:17 .
</span></span><span style=display:flex><span>drwxr-xr-x 5 oli oli   4096 Sep  5 15:17 ..
</span></span><span style=display:flex><span>-rw-r--r-- 1 oli oli 393887 Sep  5 15:17 iris_example.ipynb
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>oli@ssh-machine:~/jupyter-docker-example/notebooks$ id oli
</span></span><span style=display:flex><span>uid=9999(oli) gid=9999(oli) groups=9999(oli)
</span></span></code></pre></div><p>In comparison, here are the same commands being run in a Jupyter notebook:</p><p><img src=/posts/jupyter-docker/./img/jupyter-cell-output.png alt="Jupyter notebook showing the owner of the notebooks folder"></p><p>Note how the uids and gids between each system are different. In this case, you will find that saving to the data and notebook folders to be not be possible. To fix this, inside the <a href=https://github.com/okwilkins/jupyter-docker-example/blob/main/sample.env>.env file</a> the uid and gid of the Jupyter user is configured.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>JUPYTER_ENABLE_LAB<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>JUPYTER_USERNAME<span style=color:#f92672>=</span>jovyan
</span></span><span style=display:flex><span>JUPYTER_TOKEN<span style=color:#f92672>=</span>secret
</span></span><span style=display:flex><span>JUPYTER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8888</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ids for the Jupyter user</span>
</span></span><span style=display:flex><span>UID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>GID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>
</span></span></code></pre></div><h2 id=why-not-use-jupyterstacks>Why Not Use Jupyter Stacks?<a href=#why-not-use-jupyterstacks class=hanchor arialabel=Anchor>&#8983;</a></h2><p>You may be wondering why <a href="https://medium.com/r?url=https%3A%2F%2Fgithub.com%2Fjupyter%2Fdocker-stacks">Jupyter stacks</a> are not used. The simple reason is this: in order to change the uid/gid of the Jupyter user, you have to <em>run the container as root</em>. As mentioned above, this is removes itself from best security practices.</p><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>&#8983;</a></h2><p>In the quest to Dockerize Jupyter the right way, we&rsquo;ve embarked on a journey that many data scientists can relate to. The need for secure, reproducible, and efficient data science workflows often clashes with the pitfalls of running Docker containers as root and the intricacies of handling volumes.</p><p>By dissecting common issues and presenting practical solutions, we&rsquo;ve not only unlocked the power of Docker for Jupyter but also ensured that sensitive data remains secure. The key takeaways are:</p><ol><li><p><strong>Security First</strong>: Running Docker containers as root poses significant risks. As data scientists, we must prioritize security. Our approach, as demonstrated in the provided Dockerfile and docker-compose.yml, shifts the user away from root, enhancing the overall security of the environment.</p></li><li><p><strong>Effortless Volumes</strong>: Leveraging volumes for seamless integration with your file system is a game-changer, especially when using Jupyter in tools like VS Code. Our configuration ensures that files are owned correctly, eliminating obstacles to data reading and writing.</p></li><li><p><strong>Balancing Security and Convenience</strong>: While Jupyter stacks might seem appealing, they often come with limitations in user ID and group ID customization, requiring containers to run as root. Our approach strikes a balance, prioritizing security without sacrificing convenience.</p></li></ol></div></div><h2>Knowledge Graph</h2><div id=graph></div><script src=https://unpkg.com/force-graph@1.43.0/dist/force-graph.min.js type=module></script><script src=/js/graph.js type=module></script></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://www.okwilkins.dev/assets/main.js></script><script src=https://www.okwilkins.dev/assets/prism.js></script></div></body></html>